<?php

/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 12월 26일 금요일 오전 10시 54분 - 날씨 맑다

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 피리 게시글에 투표 PLUS G5 > 설정 정보 저장하기
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____피리_게시글에_투표
	$sub_menu = "770015";


	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');


	//=======================================================
	// 시작 => 운영자__아니면
	IF (!$is_admin)
	{
		alert ("권한이 없습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 운영자__아니면
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], "w");

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => 피리_게시글에_투표__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	// 1 - 하자
	$is_get__piree_config = 1;


	//=======================================================
	// 피리_게시글에_투표__설정_정보__가져오기
	$is_get__article_vote = 1;


	//=======================================================
	// 설정_화면__여부
	$is_piree_program_config = 1;


	//=======================================================
	// PIREE_ARTICLE_VOTE__설정_정보_파일__첨부
	include_once( get__sam_file($sub_menu, '') );

	#########################################################
	# 끝 => 피리_게시글에_투표__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING__형변환
	#########################################################

/*

	//=======================================================
	// PC__스킨
	$skin_pc_c = $_POST['skin_pc_c'];


	//=======================================================
	// 모바일__스킨
	$skin_mobile_c = $_POST['skin_mobile_c'];


	//=======================================================
	// 등록된_투표_항목_수
	$vote_item_t = $_POST["vote_item_t"];


	//=======================================================
	// 투표_등록__회원_레벨
	$vote_regi_level_n = $_POST["vote_regi_level_n"];


	//=======================================================
	// 이미지_투표
	$vote_image_ok_n = $_POST["vote_image_ok_n"];


	//=======================================================
	// 투표_등록시__차감_포인트
	$vote_regi_point_n = $_POST["vote_regi_point_n"];


	//=======================================================
	// 투표_기간__기본값
	$vote_day_default_t = $_POST["vote_day_default_t"];

*/


	//=======================================================
	// 형변환
	$vote_item_t				= (int)$vote_item_t;
	$vote_regi_level_n	= (int)$vote_regi_level_n;
	$vote_image_ok_n 		= (int)$vote_image_ok_n;
	$vote_regi_point_n	= (int)$vote_regi_point_n;
	$vote_day_default_t	= (int)$vote_day_default_t;

	#########################################################
	# 끝 => QUERY_STRING__형변환
	#########################################################



	#########################################################
	# 시작 => 상수__변수__배열
	#########################################################

	//=======================================================
	// 정보_저장__여부
	// 0 - 실패
	// 1 - 성공
	$is_save = 0;


	//=======================================================
	// 설정_저장__쿼리문
	$sql_save = "";


	//=======================================================
	// 이동할__페이지
	$go_url_s = "./pi__field_add.article.php";

	#########################################################
	# 끝 => 상수__변수__배열
	#########################################################



	#########################################################
	# 시작 => 저장용__값
	#########################################################

	//=======================================================
	// 시작 => 투표_등록시__차감_포인트__음수_이면
	IF ($vote_regi_point_n < 0)
	{
			// 투표_등록시__차감_포인트
			$vote_regi_point_n = (0-$vote_regi_point_n);
	}
	// 끝 => 투표_등록시__차감_포인트__음수_이면
	//=======================================================


	//=======================================================
	// 시작 => 등록된_투표_항목_수__없거나__20_초과하면
	IF (!$vote_item_t || $vote_item_t > 20)
	{
			// 등록된_투표_항목_수__기본값
			$vote_item_t = 20;
	}
	// 끝 => 등록된_투표_항목_수__없거나__20_초과하면
	//=======================================================

	#########################################################
	# 끝 => 저장용__값
	#########################################################



	#########################################################
	# 시작 => 피리__기본_정보_파일__첨부
	#########################################################

	//=======================================================
	// 피리__기본_정보_화일__경로
	$piree_admin_lib_path = G5_ADMIN_PATH ."/_piree/pi__lib_new.php";


	//=======================================================
	// 피리__기본_정보_파일__첨부
	include_once($piree_admin_lib_path);


	//=======================================================
	// 프로그램_정보__저장하기
	save_piree__program_info();

	#########################################################
	# 끝 => 피리__기본_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 설정__저장하기
	#########################################################

			#####################################################
			# 시작 => 스킨__저장하기
			#####################################################

			//===================================================
			// PC__스킨
			$sql_save .= "`pgs_skin_pc_c` = '". $skin_pc_c ."', ";


			//===================================================
			// MOBILE__스킨
			$sql_save .= "`pgs_skin_mo_c` = '". $skin_mobile_c ."', ";

			#####################################################
			# 끝 => 스킨__저장하기
			#####################################################



			#####################################################
			# 시작 => 항목별__저장하기
			#####################################################

			//===================================================
			// 등록된_투표_항목_수
			$sql_save .= "`pgs_cf_1_n` = '". $vote_item_t ."', ";


			//===================================================
			// 투표_등록__회원_레벨
			$sql_save .= "`pgs_cf_2_n` = '". $vote_regi_level_n ."', ";


			//===================================================
			// 이미지_투표
			$sql_save .= "`pgs_cf_3_n` = '". $vote_image_ok_n ."', ";


			//===================================================
			// 투표_등록시__차감_포인트
			$sql_save .= "`pgs_cf_4_n` = '". $vote_regi_point_n ."', ";


			//===================================================
			// 투표_기간__기본값
			$sql_save .= "`pgs_cf_5_n` = '". $vote_day_default_t ."', ";

			//===================================================
			// 투표_카테고리 설정. By BryanPark
			$sql_save .= "`pgs_cf_1_txt` = '". $vote_category_t."', ";


			#####################################################
			# 끝 => 항목별__저장하기
			#####################################################



			#####################################################
			# 시작 => 설정__저장하기
			#####################################################

			//===================================================
			// 수정하는__쿼리
			$sql	= "UPDATE `".$piree['program_sam']."` SET ";
			$sql .= $sql_save;
			$sql .= "`pgs_piree_mb_id`	= '". $piree_mb_id ."', ";
			$sql .= "`pgs_modi_time_n`	= '". G5_SERVER_TIME ."' ";
			$sql .= "WHERE `pgs_prog_n` = '". $g_program_n ."'";


			//===================================================
			// 시작 => 쿼리_실행
			IF ( !sql_query ($sql) )
			{

					// 에러_메세지
					$save_err_msg = "\\\"피리 게시글에 투표\\\" 설정 정보를 수정하지 못했습니다.";

					// 에러
					alert ($save_err_msg, $go_url_s);
					EXIT;

			}
			// 끝 => 쿼리_실행
			//===================================================

			#####################################################
			# 끝 => 설정__저장하기
			#####################################################

	#########################################################
	# 끝 => 설정__저장하기
	#########################################################



	#########################################################
	# 시작 => 필드__유무__확인하기
	#########################################################

			#####################################################
			# 시작 => ROW_1개__가져오기
			#####################################################

			//===================================================
			// ROW_1개__가져오기
			$sql = "SELECT * FROM ".$g5['board_table']." LIMIT 1";
			$row = sql_fetch($sql);

			#####################################################
			# 끝 => ROW_1개__가져오기
			#####################################################



			#####################################################
			# 시작 => 게시글에_투표___사용하면
			#####################################################
			IF (!isset($board['bo_arti_vote_use_n']))
			{

					//===============================================
					// 필드_추가__쿼리문
					$sql = "ALTER TABLE `".$g5['board_table']."` ADD `bo_arti_vote_use_n` TINYINT UNSIGNED NOT NULL DEFAULT '0'";
					sql_query ($sql, false);

			}
			#####################################################
			# 끝 => 게시글에_투표___사용하면
			#####################################################

	#########################################################
	# 끝 => 필드__유무__확인하기
	#########################################################



	#########################################################
	# 시작 => 게시글_투표__사용하면
	#########################################################

	//=======================================================
	// 게시글_투표__사용_여부
	$bo_arti_vote_use_n = $vote_item_t > 0 ? 1 : 0;


	//=======================================================
	// 게시글_투표__사용_여부__수정하는__쿼리
	$sql	= "UPDATE `".$g5['board_table']."` SET ";
	$sql .= "`bo_arti_vote_use_n` = '". $bo_arti_vote_use_n ."'";


	//=======================================================
	// 시작 => 쿼리_실행
	IF ( !sql_query ($sql) )
	{

		// 에러
		alert ("게시판에 \"게시글에 투표\" 상태를 수정하지 못했습니다.");
		EXIT;

	}
	// 끝 => 쿼리_실행
	//=======================================================

	#########################################################
	# 끝 => 게시글_투표__사용하면
	#########################################################



	#########################################################
	# 시작 => 최고_회원_레벨__수정하기
	#########################################################

	//=======================================================
	// 최고_회원_레벨__수정하는_파일__첨부
	include_once(G5_ADMIN_PATH.'/_piree/pi__member_max_level.inc.php');

	#########################################################
	# 끝 => 최고_회원_레벨__수정하기
	#########################################################



	#########################################################
	# 시작 => 마무리__페이지_이동
	#########################################################

	//=======================================================
	// 알림창
	alert ('설정 정보를 저장하였습니다.', $go_url_s, 1);
	EXIT;

	#########################################################
	# 끝 => 마무리__페이지_이동
	#########################################################


?>