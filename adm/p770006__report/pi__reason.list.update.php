<?php

/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 03월 08일 토요일 오후 16시 00분, 날씨 맑기는 하나 아직은 서늘하다

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 관리자 > 신고하기 PLUS G5 > 신고 사유 관리하기
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____신고하기
	$sub_menu = "770006";


	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
		alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], 'r');

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => 신고하기__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 신고하기__설정_정보__가져오기
	$is_get__report = 1;


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	include_once($piree_dir_path);

	#########################################################
	# 끝 => 신고하기__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING
	#########################################################

	//=======================================================
	// QUERY_STRING
	$act_button = $_POST["act_button"];

	#########################################################
	# 끝 => QUERY_STRING
	#########################################################



	#########################################################
	# 시작 => 변수
	#########################################################

	//=======================================================
	// 에러_메세지
	$error_msg = "";


	//=======================================================
	// 에러_건수
	$error_tot = 0;

	#########################################################
	# 끝 => 변수
	#########################################################



	#########################################################
	# 시작 => 레벨__선택_확인
	#########################################################

	//=======================================================
	// 반복문__수
	$loop_t = count($_POST["chk"]);


	//=======================================================
	// 시작 => 레벨__선택되지_않았다면
	IF (!$loop_t || $loop_t == 0 || $loop_t < 1)
	{
		alert($_POST["act_button"]." 하실 항목을 하나 이상 체크하세요.", "./pi__reason.list.php");
	}
	// 끝 => 레벨__선택되지_않았다면
	//=======================================================

	#########################################################
	# 끝 => 레벨__선택_확인
	#########################################################



	#########################################################
	# 시작 => 동작__구분
	#########################################################
	SWITCH ($act_button)
	{

		#######################################################
		# 시작 => 선택수정
		#######################################################
		CASE "선택수정" :

			//===================================================
			// 권한확인
			auth_check($auth[$sub_menu], "w");


			//===================================================
			// 시작 => 반복문
			FOR ($i=0; $i<$loop_t; $i++)
			{

				//=================================================
				// 반복문_순서_번호
				$k = $_POST['chk'][$i];


				//=================================================
				// 사유번호
				$res_n = $_POST["reason_n"][$k];


				//=================================================
				// 게시글__적용여부
				$prog_article = $_POST["prog_article"][$k] == 1 ? 1 : 0;


				//=================================================
				// 댓글__적용여부
				$prog_comment = $_POST["prog_comment"][$k] == 1 ? 1 : 0;


				//=================================================
				// 회원__적용여부
				$prog_member = $_POST["prog_member"][$k] == 1 ? 1 : 0;


				//=================================================
				// 순서
				$order_n = $_POST["order_n"][$k];


				//=================================================
				// 제목
				$subject_s = $_POST["subject_s"][$k];
				$subject_s = addslashes($subject_s);


				//=================================================
				// 시작 => 항목__선택하지_않았으면
				IF ($prog_article != 1 && $prog_comment != 1 && $prog_member != 1)
				{

					//===============================================
					// 시작 => 에러_건수__1건_이상이면
					IF ($error_tot > 0)
					{
						$error_msg .= "\n\n";
					}
					// 끝 => 에러_건수__1건_이상이면
					//===============================================


					//===============================================
					// 에러_메세지
					$error_msg .= "[ ".$res_n." ]번 [ 신고사유 ] 를 적용할 항목을 (게시글, 댓글, 회원) 중 1개이상 선택해 주세요.";


					//===============================================
					// 에러_건수
					$error_tot++;

				}
				// 끝 => 항목__선택하지_않았으면
				//=================================================


				//=================================================
				// 시작 => 순서__없으면__일련번호_지정
				IF (!$order_n || $order_n < 1)
				{
					$order_n = $res_n;
				}
				// 끝 => 순서__없으면__일련번호_지정
				//=================================================


				//=================================================
				// 수정_하는__쿼리문
				$sql	= "UPDATE `".$piree_table['report_reason']."` SET ";
				$sql .= "order_n=".$order_n.", ";
				$sql .= "regi_mem_mn=".$member['mb_no'].", ";
				$sql .= "regi_mem_id='".$_SESSION['ss_mb_id']."', ";
				$sql .= "regi_mem_nick='".$member['mb_nick']."', ";
				$sql .= "prog_article=".$prog_article.", ";
				$sql .= "prog_comment=".$prog_comment.", ";
				$sql .= "prog_member=".$prog_member.", ";
				$sql .= "subject_s='".$subject_s."', ";
				$sql .= "modi_time_n='".G5_SERVER_TIME."' ";
				$sql .= "WHERE num=".$res_n;


				//=================================================
				// 시작 => 수정하기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ ".$subject_s." ( ".$res_n." ) ] 번 사유를 수정하지 못했습니다.";

					// 에러
					alert ($msg_in_s, "./pi__reason.list.php");
					EXIT;

				}
				// 끝 => 수정하기
				//=================================================

			}
			// 끝 => 반복문
			//===================================================

		BREAK;
		#######################################################
		# 끝 => 선택수정
		#######################################################



		#######################################################
		# 시작 => 선택삭제
		#######################################################
		CASE "선택삭제" :

			//===================================================
			// 권한확인
			auth_check($auth[$sub_menu], "w");


			//===================================================
			// 시작 => 반복문
			FOR ($i=0; $i<$loop_t; $i++)
			{

				//=================================================
				// 반복문_순서_번호
				$k = $_POST['chk'][$i];


				//=================================================
				// 사유번호
				$res_n = $_POST["reason_n"][$k];


				//=================================================
				// 삭제하는__쿼리문
				$sql	= "DELETE FROM `".$piree_table['report_reason']."` ";
				$sql .= "WHERE num=".$res_n;


				//=================================================
				// 시작 => 삭제하기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ ".$subject_s." ( ".$res_n." ) ] 번 사유를 삭제하지 못했습니다.";

					// 에러
					alert ($msg_in_s, "./pi__reason.list.php");
					EXIT;

				}
				// 끝 => 삭제하기
				//=================================================

			}
			// 끝 => 반복문
			//===================================================

		BREAK;
		#######################################################
		# 끝 => 선택삭제
		#######################################################

	}
	#########################################################
	# 끝 => 동작__구분
	#########################################################



	#########################################################
	# 시작 => 에러__있으면
	#########################################################
	IF ($error_tot > 0)
	{

		//=====================================================
		// 에러
		alert ($error_msg, "./pi__reason.list.php");
		EXIT;

	}
	#########################################################
	# 끝 => 에러__있으면
	#########################################################



	#########################################################
	# 시작 => 페이지__이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	$go_url_s = "./pi__reason.list.php";


	//=======================================================
	// 에러
	goto_url($go_url_s);
	EXIT;

	#########################################################
	# 끝 => 회원수__새로고침_하기
	#########################################################


?>