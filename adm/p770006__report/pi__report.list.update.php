<?php
error_reporting(E_ALL);
ini_set("display_errors", 1);
/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 03월 11일 화요일 오후 14시 59분, 날씨 맑음, 덜 추움

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 관리자 > 신고하기 PLUS G5 > 신고 조치 하기
===========================================================


UPDATE `g5_member` SET pi_blind_t=0,mb_pi_report_do_t=0,mb_pi_report_get_t=0,pi_report_fail_do_t=0,mb_pi_report_rash_do_t=0;


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____신고하기
	$sub_menu = "770006";


	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');

	


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
		alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], 'r');

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING__형변환
	#########################################################

	//=======================================================
	// QUERY_STRING
	$report_n			= $_POST["report_n"];
	$del_arti_n		= $_POST["del_arti_n"];
	$result_s			= $_POST["result_s"];
	$send_msg_s		= $_POST["send_msg_s"];
	$hidden_memo_s = $_POST["hidden_memo_s"];


	//=======================================================
	// 형변환
	$report_n	 = (int)$report_n;
	$del_arti_n = (int)$del_arti_n;

	#########################################################
	# 끝 => QUERY_STRING__형변환
	#########################################################



	#########################################################
	# 시작 => 상수__변수__배열
	#########################################################

	//=======================================================
	// 회원_레벨
	$level_n = 0;


	//=======================================================
	// 사후조치__여부
	// 0 - 에러
	// 1 - 정상
	$result_ok = 0;


	//=======================================================
	// 무분별한_신고__여부
	// 0 - 아님
	// 1 - 맞음
	$is__rash = 0;


	//=======================================================
	// 시작 => 메세지_전달_방법__쪽지
	//	- 안함
	// 쪽지 - 쪽지로 보냄
	IF (isset($send_msg_s))
	{
		$send_how_s = "쪽지";
	}
	ELSE
	{
		$send_how_s = "";
	}
	// 끝 => 메세지_전달_방법__쪽지
	//=======================================================


	//============== 2016-07-28 by Bryan Park =============
	//$qstr-> 필요한 파라매터들.


	//IF(!isset($qstr) || $qstr ==''){//QSTR이 없을때 post 받은걸 씀.
		$qstr = (isset($_POST['qstr']))?$_POST['qstr']:"sst=&sod=&sfl=&stx=&page=&bid=&bno=&menu=untreated&mattr=all";
		//$qstr = (isset($_GET['qstr']))?$_GET['qstr']:"sst=&sod=&sfl=&stx=&page=&bid=&bno=&menu=untreated&mattr=all";
	//}

	//=======================================================
	// 이동할__페이지 //2016-07-28 수정함. report.list.php였던 것을 index로 수정. by Bryan Park
	$go_url_s = "index.php?{$qstr}&report_n=".$report_n;
	
	#########################################################
	# 끝 => 상수__변수__배열
	#########################################################



	#########################################################
	# 시작 => 유효검사
	#########################################################

	//=======================================================
	// 시작 => 신고_번호__입력하지_않았으면
	IF (!$report_n || $report_n == 0)
	{
		// 에러
		alert ("[ 신고 번호 ] 가 전달되지 않았습니다.", $go_url_s);
		EXIT;
	}
	// 끝 => 신고_번호__입력하지_않았으면
	//=======================================================

	#########################################################
	# 끝 => 유효검사
	#########################################################



	#########################################################
	# 시작 => 신고하기__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 현재__상태
	$active_s = "";


	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 신고하기__설정_정보__가져오기
	$is_get__report = 1;


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	include_once($piree_dir_path);

	#########################################################
	# 끝 => 신고하기__설정_정보_파일__첨부
	#########################################################

	#########################################################
	# 시작 => 신고_내역__정보__가져오기
	#########################################################

	//=======================================================
	// 신고_내역__정보__가져오기
	$sql = "SELECT * FROM `".$piree_table['report_list']."` WHERE num='".$report_n."'";
	$row = sql_fetch($sql);


	//=======================================================
	// 시작 => 신고_내역__정보__오류_이면
	IF ($report_n != $row['num'])
	{
		// 에러
		alert ("신고 내역 정보가 없습니다.", $go_url_s);
		EXIT;
	}
	// 끝 => 신고_내역__정보__오류_이면
	//=======================================================

	#########################################################
	# 끝 => 신고_내역__정보__가져오기
	#########################################################



	#########################################################
	# 시작 => 신고_내역__정보__변수
	#########################################################

	//=======================================================
	// DO_회원
	$do_mem_mn	 = $row["do_mem_mn"];
	$do_mem_id	 = $row["do_mem_id"];
	$do_mem_nick = $row["do_mem_nick"];


	//=======================================================
	// GET_회원
	$get_mem_mn	 = $row["get_mem_mn"];
	$get_mem_id	 = $row["get_mem_id"];
	$get_mem_nick = $row["get_mem_nick"];


	//=======================================================
	// 처리한_운영자
	$res_mem_mn	 = $row["res_mem_mn"];
	$res_mem_id	 = $row["res_mem_id"];
	$res_mem_nick = $row["res_mem_nick"];


	//=======================================================
	// 신고__구분
	$prog_div_c = $row["prog_div_c"];


	//=======================================================
	// 테이블_이름
	$bo_table = $row['bo_table'];


	//=======================================================
	// 자료_번호
	$arti_n = $row["arti_n"];


	//=======================================================
	// 보모글_번호
	$parent_n = $row["parent_n"];


	//=======================================================
	// 신고_사유_번호
	$reason_n = $row["reason_n"];


	//=======================================================
	// 신고_메모
	$memo_s = $row["memo_s"];


	//=======================================================
	// 결과_상태
	$resu_s = $row['resu_s'];


	//=======================================================
	// 결과_메모
	$resu_ms = $row["resu_ms"];


	//=======================================================
	// 신고_게시물_제목
	$report_title_s = stripslashes($row["title_s"]);
	$report_title_s = addslashes($report_title_s);

	#########################################################
	# 끝 => 신고_내역__정보__변수
	#########################################################



	#########################################################
	# 시작 => 결과__이미_처리_되었으면
	#########################################################

	//=======================================================
	// 시작 => 결과__이미_처리_되었으면
	IF ($active_s == "완료" || $resu_s == "회원레벨 강등" || $resu_s == "회원 탈퇴" || $resu_s == "무분별한 신고" || $resu_s == "블라인드 해제" || $resu_s == "게시물 삭제")
	{
		alert ("이미 처리한 신고건입니다", $go_url_s);
		EXIT;
	}
	// 끝 => 결과__이미_처리_되었으면
	//=======================================================

	#########################################################
	# 끝 => 결과__이미_처리_되었으면
	#########################################################



	#########################################################
	# 시작 => 상수__변수__배열
	#########################################################

	//=======================================================
	// 신고_구분
	$report_prog_arr = get__report_div($prog_div_c, $bo_table);


	//=======================================================
	// 링크__가져오기
	$report_row_url = get_report_row_url('user_url', $row["prog_div_c"], $row['bo_table'], $row["arti_n"], $row["parent_n"], $row["get_mem_id"]);


	//=======================================================
	// 쿼리문_조건절
	$sql_pc_bt_an = "prog_div_c='".$prog_div_c."' AND bo_table='".$bo_table."' AND arti_n=".$arti_n;

	#########################################################
	# 끝 => 상수__변수__배열
	#########################################################



	#########################################################
	# 시작 => GET_회원정보__가져오기
	#########################################################

	//=======================================================
	// 선택된__신고의__GET_회원정보__배열
	$get_member = array();


	//=======================================================
	// 선택된__신고의__GET_회원정보__불러오기
	$sql				= "SELECT mb_id,mb_level FROM `".$g5['member_table']."` WHERE mb_no=".$get_mem_mn;
	$get_member = sql_fetch($sql);

	#########################################################
	# 끝 => GET_회원정보__가져오기
	#########################################################



	#########################################################
	# 시작 => 새알림
	#########################################################

	//=======================================================
	// 새알림__변수

	// 새알림__대상자
	$my_mem_id = $get_member["mb_id"];

	// 새알림__발생자
	$do_mem_id	 = $_SESSION['ss_mb_id'];
	$do_mem_nick = $member['mb_nick'];

	// 프로그램_구분
	$prog_c = $prog_div_c;

	// 알림_관계_아이디
	$prog_id = $get_member["mb_id"];

	// 테이블_이름
	// $bo_table = $bo_table;

	// 게시물_번호
	$new_arti_n = $report_n;

	// 부모글_번호
	$parent_n = $arti_n;

	// 참고_번호
	$refer_1_n = 0;
	$refer_2_n = 0;
	$refer_1_s = "";
	$refer_2_s = $prog_div_c;


	//=======================================================
	// 시작 => 댓글__이면
	IF ($prog_c == "comment")
	{
		// 참고_번호__댓글_번호
		$refer_1_n = $arti_n;
	}
	// 끝 => 댓글__이면
	//=======================================================


	//=======================================================
	// 새알림__저장_여부____신고_대상자__DO_회원
	// 0 - 안해
	// 1 - 저장
	$save_annonce__do = 0;


	//=======================================================
	// 새알림__저장_여부____신고_대상자__GET_회원
	// 0 - 안해
	// 1 - 저장
	$save_annonce__get = 0;

	#########################################################
	# 끝 => 새알림
	#########################################################



	#########################################################
	# 시작 => 사후_조치__구분
	#########################################################

	//=======================================================
	// 시작 => 사후_조치__구분
	SWITCH ($result_s)
	{

		#######################################################
		# 시작 => 회원레벨_강등
		#######################################################
		CASE "회원레벨 강등" :

				###################################################
				# 시작 => QUERY_STRING__변수
				###################################################

				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "완료";


				//=================================================
				// 레벨_강등_상태_메세지
				$level_down__active_s = "신고 결과 강등";


				//=================================================
				// QUERY_STRING
				$level_n = $_POST["level_n"];


				//=================================================
				// 형변환
				$level_n = (int)$level_n;

				###################################################
				# 끝 => QUERY_STRING__변수
				###################################################



				###################################################
				# 시작 => 레벨_변경__여부
				###################################################

				//=================================================
				// 시작 => 신고_면제__레벨이면
				IF ($get_member["mb_level"] >= $report_config["exemption_level_n"])
				{
					// 에러
					$park = print_r($report_config,TRUE);
					alert ($park." AND ".$get_member["mb_level"]."and".$report_config["exemption_level_n"]."선택하신 회원은 [ 회원레벨 강등 ] 대상이 아닙니다.", $go_url_s);
					EXIT;
				}
				// 끝 => 신고_면제__레벨이면
				//=================================================


				//=================================================
				// 레벨_변경__여부
				// 0 - 안해
				// 1 - 변경해
				$is_level_change = 1;


				//=================================================
				// 시작 => 관리자__이면
				IF (is_admin($row['get_mem_id']))
				{

					//===============================================
					// 레벨_변경__여부
					// 0 - 안해
					$is_level_change = 0;

				}
				// 끝 => 관리자__이면
				//=================================================


				//=================================================
				// 시작 => 레벨__0_1__이면
				IF ($get_member["mb_level"] < 2)
				{

					//===============================================
					// 레벨_변경__여부
					// 0 - 안해
					$is_level_change = 0;

				}
				// 끝 => 레벨__0_1__이면
				//=================================================

				###################################################
				# 끝 => 레벨_변경__여부
				###################################################



				###################################################
				# 시작 => 유효__검증
				###################################################

				//=================================================
				// 시작 => 현재__레벨__같거나_높으면
				IF ($level_n >= $get_member["mb_level"])
				{
					// 에러
					alert ("강등하려는 GET 회원 레벨은 현재 레벨보다 낮아야 합니다.", $go_url_s);
					EXIT;
				}
				// 끝 => 현재__레벨__같거나_높으면
				//=================================================


				//=================================================
				// 시작 => 운영자_레벨과__같거나_높으면
				IF ($level_n >= $member['mb_level'])
				{
					// 에러
					alert ("강등하려는 GET 회원 레벨이 운영자 레벨보다 낮아야 합니다.", $go_url_s);
					EXIT;
				}
				// 끝 => 운영자_레벨과__같거나_높으면
				//=================================================

				###################################################
				# 끝 => 유효__검증
				###################################################



				###################################################
				# 시작 => 레벨__변경
				###################################################

				//=================================================
				// GET_회원_레벨__강등하기
				$sql	= "UPDATE `".$g5["member_table"]."` SET ";
				$sql .= "mb_level='".$level_n."' ";
				$sql .= "WHERE mb_no=".$get_mem_mn;


				//=================================================
				// 시작 => 입력하기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ GET 회원 ] 의	레벨을 강등하지 못했습니다.";

					// 에러
					alert ($msg_in_s, $go_url_s);
					EXIT;

				}
				// 끝 => 입력하기
				//=================================================

				###################################################
				# 끝 => 레벨__변경
				###################################################



				###################################################
				# 시작 => 레벨_변경_기록__남기기
				###################################################

				//=================================================
				// 시작 => 레벨_관련_프로그램_번호__있으면
				IF (defined('PIREE_PLUS_LEVEL_PROG_N'))
				{

						//=============================================
						// 라이브러리_파일_첨부하기
						include_once(PIREE_CONFIG_PATH.'/p__'.PIREE_PLUS_LEVEL_PROG_N.'/pi__config.php');


						//=============================================
						// 즉시_여부
						$config_use_auto_n = 1;


						//=============================================
						// 진행상태__문자열
						$level_active_s = "신고 접수 레벨 강등";


						//=============================================
						// 시작 => 신청_변경_기록__남기기
						IF (!save__level_log($get_mem_id, $level_n, $config_use_auto_n, $level_active_s))
						{

							// 메세지
							$msg_in_s = "예기치 못한 에러로 선택한 회원의\\n\\n레벨을 ".$level_msg." (으)로변경하지 못했습니다.";

							// 에러
							alert ($msg_in_s, $go_url_s);
							EXIT;

						}
						// 끝 => 신청_변경_기록__남기기
						//=============================================

				}
				// 끝 => 레벨_관련_프로그램_번호__있으면
				//=================================================

				###################################################
				# 끝 => 레벨_변경_기록__남기기
				###################################################

		BREAK;
		#######################################################
		# 끝 => 회원레벨_강등
		#######################################################



		#######################################################
		# 시작 => 회원_탈퇴
		#######################################################
		CASE "회원 탈퇴" :

				###################################################
				# 끝 => 선처리__상수__변수__배열
				###################################################

				//=================================================
				// 시작 => 신고_면제__레벨이면
				IF ($get_member["mb_level"] >= $report_config["exemption_level_n"])
				{
					// 에러
					alert ("선택하신 회원은 [ 회원 탈퇴 ] 대상이 아닙니다.", $go_url_s);
					EXIT;
				}
				// 끝 => 신고_면제__레벨이면
				//=================================================


				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "완료";

				###################################################
				# 끝 => 선처리__상수__변수__배열
				###################################################

		BREAK;
		#######################################################
		# 끝 => 회원_탈퇴
		#######################################################



		#######################################################
		# 시작 => 판단_보류
		#######################################################
		CASE "판단 보류" :

				###################################################
				# 시작 => 상수__변수__배열
				###################################################

				//=================================================
				// 특별히_조치할것__없음

				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "보류";


				//=================================================
				// 게시물_삭제
				$del_arti_n = 0;

				###################################################
				# 끝 => 상수__변수__배열
				###################################################

		BREAK;
		#######################################################
		# 끝 => 판단_보류
		#######################################################



		#######################################################
		# 시작 => 무분별한_신고
		#######################################################
		CASE "무분별한 신고" :

				###################################################
				# 시작 => 상수__변수__배열
				###################################################

				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "완료";


				//=================================================
				// 무분별한_신고__여부
				// 1 - 맞음
				$is__rash = 1;


				//=================================================
				// 무분별한_신고__문자열
				$rash_s = "무분별한 신고";


				//=================================================
				// 신고_권한
				// 0 - 없음
				$mb_pi_report_auth__no = 0;

				###################################################
				# 끝 => 상수__변수__배열
				###################################################

		BREAK;
		#######################################################
		# 끝 => 무분별한_신고
		#######################################################



		#######################################################
		# 시작 => 조치없이_완료
		#######################################################
		CASE "블라인드 해제" :

				###################################################
				# 시작 => 상수__변수__배열
				###################################################

				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "완료";


				//=================================================
				// 게시물_삭제
				$del_arti_n = 0;

				###################################################
				# 끝 => 상수__변수__배열
				###################################################

		BREAK;
		#######################################################
		# 끝 => 조치없이_완료
		#######################################################



		#######################################################
		# 시작 => 게시물_삭제
		#######################################################
		CASE "게시물 삭제" :

				###################################################
				# 시작 => 상수__변수__배열
				###################################################

				//=================================================
				// 시작 => 신고_대상_구분__회원_이면__에러
				IF ($prog_div_c == "member")
				{
						alert ("신고대상이 회원이면 게시물 삭제할수 없습니다.");
						exit;
				}
				// 끝 => 신고_대상_구분__회원_이면__에러
				//=================================================


				//=================================================
				// 사후조치__여부
				// 1 - 정상
				$result_ok = 1;


				//=================================================
				// 현재__상태
				$active_s = "완료";


				//=================================================
				// 게시물_삭제
				$del_arti_n = 1;

				###################################################
				# 끝 => 게시물_삭제
				###################################################

		BREAK;
		#######################################################
		# 끝 => 조치없이_완료
		#######################################################

	}
	// 끝 => 사후_조치__구분
	//=======================================================

	#########################################################
	# 끝 => 사후_조치__구분
	#########################################################



	#########################################################
	# 시작 => 사후_조치__정상__여부
	#########################################################

	//=======================================================
	// 시작 => 사후_조치__정상__여부
	IF ($result_ok == 1)
	{

		#######################################################
		# 시작 => 사후_조치__정상
		#######################################################

		//=====================================================
		// 조치_입력_하는__쿼리문
		$sql	= "UPDATE `".$piree_table['report_list']."` SET ";
		$sql .= "res_mem_mn='".$member['mb_no']."', ";
		$sql .= "res_mem_id='".$_SESSION['ss_mb_id']."', ";
		$sql .= "res_mem_nick='".$member['mb_nick']."', ";
		$sql .= "active_s='".$active_s."', ";
		$sql .= "resu_s='".$result_s."', ";
		$sql .= "hidden_memo_s='".$hidden_memo_s."', ";
		$sql .= "send_how_s='".$send_how_s."', ";
		$sql .= "send_msg_s='".$send_msg_s."', ";
		$sql .= "resu_time_n='".G5_SERVER_TIME."' ";
		$sql .= "WHERE ".$sql_pc_bt_an;


		//=====================================================
		// 시작 => 입력하기
		IF ( !sql_query ($sql) )
		{

			// 메세지
			$msg_in_s = "[ 신고 내용 ] 을 사후 조치하지 못했습니다.";

			// 에러
			alert ($msg_in_s, $go_url_s);
			EXIT;

		}
		// 끝 => 입력하기
		//=====================================================

		#######################################################
		# 끝 => 사후_조치__정상
		#######################################################

	}
	ELSE
	{

		#######################################################
		# 시작 => 사후_조치__이상함
		#######################################################

		// 에러
		alert ("[ 신고 자료 ] 사후 조치 오류입니다.", $go_url_s);
		EXIT;

		#######################################################
		# 끝 => 사후_조치__이상함
		#######################################################

	}
	// 끝 => 사후_조치__정상__여부
	//=======================================================

	#########################################################
	# 끝 => 사후_조치__정상__여부
	#########################################################



	#########################################################
	# 시작 => 프로그램__구분
	#########################################################

	//=======================================================
	// 시작 => 프로그램__구분
	SWITCH ($prog_div_c)
	{
		
		#######################################################
		# 시작 => 게시물
		#######################################################
		CASE "article" :

			//===================================================
			// 게시판_테이블__전체이름
			$write_table = $g5['write_prefix'].$bo_table;


			//===================================================
			// 시작 => 신고_대상__아니라__판단_했으면
			IF ($result_s == "무분별한 신고" || $result_s == "블라인드 해제")
			{

					//===============================================
					// 신고_불가_상태__처리하는__쿼리문
					$sql	= "UPDATE `".$report_prog_arr["arti_table"]."` SET ";
					$sql .= "wr_pi_report_t='".$pi_report_n__free."' ";// 2016-07-12 신고수도 0 ('')으로 처리되는 것으로 확인 by Bryan Park
					$sql .= ", wr_blind='0' ";// 2016-07-12 블라인드수 0으로. by Bryan Park
					$sql .= "WHERE wr_id='".$arti_n."'";
					

					//===============================================
					// 쿼리_실행__여부
					$is_sql_go = 1;

			}
			// 끝 => 사후_조치__정상__여부
			//===================================================

		BREAK;
		#######################################################
		# 끝 => 게시물
		#######################################################



		#######################################################
		# 시작 => 댓글
		#######################################################
		CASE "comment" :

			//===================================================
			// 게시판_테이블__전체이름
			$write_table = $g5['write_prefix'].$bo_table;


			//===================================================
			// 댓글_원_게시물__가져오기
			$sql = "SELECT wr_parent FROM `".$write_table."` WHERE wr_id='".$arti_n."'";
			$wr_parent = sql_efv($sql);


			//===================================================
			// 시작 => 신고_대상__아니라__판단_했으면
			IF ($result_s == "무분별한 신고" || $result_s == "블라인드 해제")
			{

					//===============================================
					// 신고_불가_상태__처리하는__쿼리문
					$sql	= "UPDATE `".$report_prog_arr["arti_table"]."` SET ";
					$sql .= "wr_pi_report_t='".$pi_report_n__free."' ";
					$sql .= "WHERE wr_id='".$arti_n."'";

					//===============================================
					// 쿼리_실행__여부
					$is_sql_go = 1;

			}
			// 끝 => 사후_조치__정상__여부
			//===================================================

		BREAK;
		#######################################################
		# 끝 => 댓글
		#######################################################



		#######################################################
		# 시작 => 회원
		#######################################################
		CASE "member" :


			//===================================================
			// 시작 => 신고_대상__아니라__판단_했으면
			IF ($result_s == "무분별한 신고" || $result_s == "블라인드 해제")
			{

					//===============================================
					// 신고_불가_상태__처리하는__쿼리문
					$sql	= "UPDATE `".$report_prog_arr["arti_table"]."` SET ";
					$sql .= "mb_pi_report_member_t='".$pi_report_n__free."' ";
					$sql .= "WHERE mb_no='".$get_mem_mn."'";


					//===============================================
					// 쿼리_실행__여부
					$is_sql_go = 1;

			}
			// 끝 => 사후_조치__정상__여부
			//===================================================

		BREAK;
		#######################################################
		# 끝 => 회원
		#######################################################

	}
	
	

	// 끝 => 프로그램__구분
	//=======================================================


	//=======================================================
	// 시작 => 신고_대상__아니라__판단_했으면
	IF ($result_s == "무분별한 신고" || $result_s == "블라인드 해제")
	{

		//=====================================================
		// 시작 => 쿼리_실행하기
		IF ($is_sql_go == 1)
		{

			//===================================================
			// 시작 => 실행하기
			IF ( !sql_query ($sql) )
			{

				// 메세지
				$msg_in_s = "선택하신 자료를 [ ".$result_s." ] 조치 하지 못했습니다.";

				// 에러
				alert ($msg_in_s, $go_url_s);
				EXIT;

			}
			ELSE{
				
				

				#######################################################
				#// 시작 - 2016-07-12 어떤 분류든 간 블라인드 해제 필요 -> 해당 신고 번호를 이용. by Bryan Park
				#######################################################
				//===================================================
				// 2016-07-12 블라인드당한 유저 다시 해제 시켜주는 sql문 by Bryan Park
				/*$sql_unblock = " DELETE FROM g5__piree_770006_black_list ";
				$sql_unblock .= " WHERE  bo_table = '".$row['bo_table']."' AND "; // 2016-07-12 해당 게시물에 대한 신고 조치로 차단된 리스트 삭제[변경함] by Bryan Park
				$sql_unblock .= " wr_id = '".$row['arti_n']."'"; //2016-07-13 -> 해당 게시물로 인해 차단된 내역 모두 삭제.
				*/
				$sql_unblock = " UPDATE g5__piree_770006_black_list SET bl_active = 'N' ";
				$sql_unblock .= " WHERE  bo_table = '".$row['bo_table']."' AND "; // 2016-07-12 해당 게시물에 대한 신고 조치로 차단된 리스트 삭제[변경함] by Bryan Park
				$sql_unblock .= " wr_id = '".$row['arti_n']."'";
				###################################### by Bryan Park - 수정 필요 -> innocent를 rp_num이 아니라 다른기준으로 해야함.
				IF(!sql_query($sql_unblock)){

					// 메세지
					$msg_in_s = $sql_unblock."선택하신 자료를 [".$result_s."-불량회원 목록에서 해제] 하지 못했습니다.";

					// 에러
					alert ($msg_in_s, $go_url_s);
					EXIT;
				}
				ELSE{
					// 2016-07-12 affected_rows() 함수를 이용 지워진 블랙리스트 수 만큼 원래대로 돌려줌. by Bryan Park
					$innocent_blind_count = sql_affected_rows();//무고하게 당한 블라인드 횟수
					$sql_minus_blind_count  = " UPDATE `".$g5['member_table']."` SET ";
					$sql_minus_blind_count .= " mb_pi_blind_t = mb_pi_blind_t-{$innocent_blind_count} "; //블라인드당한횟수를 무고한 횟수만큼 감쇄
					$sql_minus_blind_count .= " WHERE mb_id = '{$row[get_mem_id]}' "; //현 신고건에 해당하는 맴버의.
					

					IF($innocent_blind_count != 1){
						// 보통은 1이여야 함. 그래서 2이상일때는 경고 코드를 출력하게끔.
						$msg_in_s = "[경고]Blind count 가 '{$innocent_blind_count}' 감소합니다.";
						alert($msg_in_s);
					}
					IF(!sql_query($sql_minus_blind_count)){
						// 메세지
						$msg_in_s = "선택하신 자료를 [".$result_s."-무고한 블라인드 횟수 차감] 하지 못했습니다.";

						// 에러
						alert ($msg_in_s, $go_url_s);
						EXIT;
					}
				}
				

				//============== 2016-07-28 by Bryan Park =============
				//delete__blinded_list(); 함수를 사용해서 blinded_list 테이블에서
				//row를 삭제하여야 한다.
				delete__blinded_list($row['bo_table'],$row['arti_n']);



				#######################################################
				#// 끝 - 2016-07-12 어떤 분류든 간 블라인드 해제 필요 -> 해당 신고 번호를 이용. by Bryan Park
				#######################################################
			}
			// 끝 => 실행하기
			//===================================================


			

		}
		// 끝 => 쿼리_실행하기
		//=====================================================

	}
	// 끝 => 사후_조치__정상__여부
	//=======================================================

	#########################################################
	# 끝 => 사후_조치__정상__여부
	#########################################################



	#########################################################
	# 시작 => 회원_탈퇴
	#########################################################

	//=======================================================
	// 시작 => 회원_탈퇴__이면
	IF ($result_s == "회원 탈퇴")
	{

		//=====================================================
		// 회원자료__삭제
		member_delete($get_mem_id);

	}
	// 끝 => 회원_탈퇴__이면
	//=======================================================

	#########################################################
	# 끝 => 회원_탈퇴
	#########################################################



	#########################################################
	# 시작 => 게시물_삭제
	#########################################################

	//=======================================================
	// 시작 => 게시물_삭제__이면
	IF ($del_arti_n == 1)
	{

		//=====================================================
		// 시작 => 자료_구분__게시물_댓글__이면
		IF ($report_prog_arr["prog_s"] == "게시물" || $report_prog_arr["prog_s"] == "댓글")
		{

			//===================================================
			// 게시물_삭제하는__쿼리문
			$sql = "DELETE FROM `".$report_prog_arr["arti_table"]."` WHERE wr_id='".$arti_n."'";


			//===================================================
			// 시작 => 입력하기
			IF ( !sql_query ($sql) )
			{

				// 메세지
				$msg_in_s = "신고된 [ ".$report_prog_arr["prog_s"]." ] 을 삭제하지 못했습니다.";

				// 에러
				alert ($msg_in_s, $go_url_s);
				EXIT;

			}
			// 끝 => 입력하기
			//===================================================

		}
		// 끝 => 자료_구분__게시물_댓글__이면
		//=====================================================

	}
	// 끝 => 게시물_삭제__이면
	//=======================================================

	#########################################################
	# 끝 => 게시물_삭제
	#########################################################



	#########################################################
	# 시작 => DO_회원__처리하기
	#########################################################

	//=======================================================
	// 같은_신고_목록__불러오기
	$sql		= "SELECT num,do_mem_mn,do_mem_id FROM `".$piree_table['report_list']."` WHERE ".$sql_pc_bt_an;
	$result = sql_query ($sql);


	//=======================================================
	// 시작 => 반복문
	FOR ($i=0; $row=sql_fetch_array($result); $i++)
	{

		#######################################################
		# 시작 => 무분별한_신고__이면
		#######################################################

		//=====================================================
		// 시작 => 무분별한_신고__이면
		IF ($is__rash == 1)
		{

			#####################################################
			# 시작 => 포인트__차감하기
			#####################################################

			//===================================================
			// 시작 => 무분별한_신고__포인트__있으면
			IF ($report_config["report_rash_point_n"])
			{

				//=================================================
				// 포인트_거래__사유
				$point_trade_s = $rash_s." : ".$row['num']."번";


				//=================================================
				// 포인트__거래
				insert_point($row["do_mem_id"], $report_config["report_rash_point_n"], $point_trade_s, $bo_table, $arti_n, '신고 RASH');

			}
			// 끝 => 무분별한_신고__포인트__있으면
			//===================================================

			#####################################################
			# 끝 => 포인트__차감하기
			#####################################################

			###########################################################
			# 시작 => //2016-08-08 무분별한 신고의 경우 report_rash_do_t++ 해야함. by Bryan Park
			###########################################################
			$sql_rash   = " UPDATE `".$g5['member_table']."` SET ";
			$sql_rash  .= " mb_pi_report_rash_do_t = mb_pi_report_rash_do_t + 1 "; //무분별한 신고 횟수 증가.
			$sql_rash  .= " WHERE mb_id = '{$row[do_mem_id]}' "; //현 신고건에 해당하는 신고자/

			IF(!sql_query($sql_rash)){
				// 메세지
				$msg_in_s = "선택하신 자료를 [".$result_s."- 무분별한 신고자 처리(무분별신고횟수++)] 하지 못했습니다.";

				// 에러
				alert ($msg_in_s, $go_url_s);
				EXIT;
			}
			###########################################################
			# 끝 => //2016-08-08 무분별한 신고의 경우 report_rash_do_t++ 해야함. by Bryan Park
			###########################################################


			#####################################################
			# 시작 => 신고_권한__제한하기
			#####################################################

			//===================================================
			// 무분별한_신고__건수__파악하기
			/*$sql		= "SELECT COUNT(*) FROM `".$piree_table['report_list']."` ";
			$sql	 .= "WHERE do_mem_mn='".$row["do_mem_mn"]."' AND resu_s='".$rash_s."'";
			$rash_t = sql_efv($sql);*/ //2016-08-08 주석처리. by Bryan Park

			//============== 2016-08-08 by Bryan Park =============
			// 무분별한_신고__건수__파악하기__수정본.
			$sql_rash   = " SELECT mb_pi_report_rash_do_t FROM `".$g5['member_table']."`";
			$sql_rash  .= " WHERE mb_id = '{$row[do_mem_id]}' "; //현 신고건에 해당하는 신고자/
			$rash_t = sql_efv($sql);


			//===================================================
			// 시작 => 무분별한_신고시__신고_권한__제한__회수_도달__했으면
			IF ($rash_t >= $report_config["report_rash_auth_n"] &&$report_config["report_rash_auth_n"]!=0)
			{// 2016-07-12 report_rash_auth_n 이 0으로 되있으면 권한 제한 안한다.. 이게 안되있었다니... by Bryan Park

				//=================================================
				// 입력_하는__쿼리문
				$sql	= "UPDATE `".$g5['member_table']."` SET ";
				$sql .= "mb_pi_report_auth='".$mb_pi_report_auth__no."' ";
				$sql .= "WHERE mb_no='".$row["do_mem_mn"]."'";


				//=================================================
				// 시작 => 입력하기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ 신고한 (DO) 회원 ] 의 무분별한 신고로 인하여 [ 신고 권한 ] 을 회수하지 못했습니다.";

					// 에러
					alert ($msg_in_s, $go_url_s);
					EXIT;

				}
				// 끝 => 입력하기
				//=================================================

			}
			// 끝 => 무분별한_신고시__신고_권한__제한__회수_도달__했으면
			//===================================================

			#####################################################
			# 끝 => 신고_권한__제한하기
			#####################################################

		}
		// 끝 => 무분별한_신고__이면
		//=====================================================

		#######################################################
		# 끝 => 무분별한_신고__이면
		#######################################################

	}
	// 끝 => 반복문
	//=======================================================

	#########################################################
	# 끝 => DO_회원__처리하기
	#########################################################



	#########################################################
	# 시작 => 메세지__전달
	#########################################################

	//=======================================================
	// 시작 => 신고_대상자에게_전달할_메세지__있으면
	IF ($send_msg_s != "")
	{

		//=====================================================
		// 신고_대상자에게_전달할_메세지
		$send_msg_s = stripslashes($send_msg_s);
		$send_msg_s = stripslashes($send_msg_s);
		$send_msg_s = addslashes($send_msg_s);


		//=====================================================
		// 시작 => 메세지_전달_방법__구분
		SWITCH ($send_how_s)
		{

			#####################################################
			# 시작 => 쪽지
			#####################################################
			CASE "쪽지" :

				###################################################
				# 시작 => 쪽지_변수
				###################################################

				//=================================================
				// 마지막_일련번호__알아내기
				$sql = "SELECT MAX(me_id) FROM `".$g5['memo_table']."`";
				$max_me_id = sql_efv($sql);


				//=================================================
				// 일련번호__만들기
				$max_me_id = (int)$max_me_id+1;


				//=================================================
				// 쪽지_받는_회원
				$recv_mb_id	 = $get_mem_id;
				$recv_mb_nick = $get_mem_nick;


				//=================================================
				// 신고_대상자에게_전달할__쪽지_메세지
				$send_memo_s	= "신고가 접수되었습니다.\n\n\n\n";
				$send_memo_s .= "구분 : ".$report_prog_arr["prog_s"]." \n\n";
				$send_memo_s .= "URL : ".$report_row_url." \n\n";
				$send_memo_s .= "게시물 : ".$report_title_s."\n\n";
				$send_memo_s .= "\n\n";
				$send_memo_s .= $send_msg_s;

				###################################################
				# 끝 => 쪽지_변수
				###################################################



				###################################################
				# 시작 => 쪽지__보내기
				###################################################

				//=================================================
				// 쪽지__보내는_쿼리
				$sql	= "INSERT INTO `".$g5['memo_table']."` SET ";
				$sql .= "me_id='".$max_me_id."', ";
				$sql .= "me_recv_mb_id='".$recv_mb_id."', ";
				$sql .= "me_send_mb_id='".$_SESSION['ss_mb_id']."', ";
				$sql .= "me_send_datetime='".G5_TIME_YMDHIS."', ";
				$sql .= "me_memo='".$send_memo_s."'";


				//=================================================
				// 시작 => 쪽지__보내기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ 신고 대상 (GET) 회원 ] 에게 [ 전달할 메세지 ] 를 보내지 못했습니다.";

					// 에러
					alert ($msg_in_s, $go_url_s);
					EXIT;

				}
				// 끝 => 쪽지__보내기
				//=================================================

				###################################################
				# 끝 => 쪽지__보내기
				###################################################



				###################################################
				# 시작 => 실시간__쪽지_알림__기능
				###################################################

				//=================================================
				// 실시간__쪽지_알림__쿼리
				$sql	= "UPDATE `".$g5['member_table']."` SET ";
				$sql .= "mb_memo_call='".$_SESSION['ss_mb_id']."' ";
				$sql .= "WHERE mb_id='".$recv_mb_id."'";


				//=================================================
				// 시작 => 쪽지__보내기
				IF ( !sql_query ($sql) )
				{

					// 메세지
					$msg_in_s = "[ 신고 대상 (GET) 회원 ] 의 [ 실시간 쪽지 알림 ] 을 저장하지 못했습니다.";

					// 에러
					alert ($msg_in_s, $go_url_s);
					EXIT;

				}
				// 끝 => 쪽지__보내기
				//=================================================

				###################################################
				# 끝 => 실시간__쪽지_알림__기능
				###################################################

			BREAK;
			#####################################################
			# 끝 => 쪽지
			#####################################################

		}
		// 끝 => 메세지_전달_방법__구분
		//=====================================================

	}
	// 끝 => 신고_대상자에게_전달할_메세지__있으면
	//=======================================================

	#########################################################
	# 끝 => 메세지__전달
	#########################################################



	#########################################################
	# 시작 => 게시물_수_댓글_수__새로고침
	#########################################################

	//=======================================================
	// 게시물_수_댓글_수__새로고침
	realod_row_count($prog_div_c, $bo_table, $arti_n);

	#########################################################
	# 끝 => 게시물_댓글_수__새로고침_하기
	#########################################################



	#########################################################
	# 시작 => 페이지__이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	//$go_url_s = "./pi__report.list.php?report_n=".$report_n;
	//$go_url_s = "index.php?{$qstr}&report_n=".$report_n;


	//=======================================================
	// 에러
	//alert($go_url_s);
	goto_url($go_url_s);
	EXIT;

	#########################################################
	# 끝 => 회원수__새로고침_하기
	#########################################################


?>