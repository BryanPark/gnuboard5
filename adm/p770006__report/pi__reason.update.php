<?php

/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 03월 08일 토요일 오전 02시 57분, 날씨 꽃샘추위 위세가 좀 쎄다, 쌀쌀하다

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 관리자 > 신고하기 PLUS G5 > 신고항목 목록보기
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____신고하기
	$sub_menu = "770006";


	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');


	//=======================================================
	// 시작 => 회원_여부__확인
	IF ($is_guest || !$is_member)
	{
		alert ("회원만 이용하실 수 있습니다", G5_DOMAIN."/");
		EXIT;
	}
	// 끝 => 회원_여부__확인
	//=======================================================


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], 'r');

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => QUERY_STRING__형변환
	#########################################################

	//=======================================================
	// QUERY_STRING
	$prog_article = $_POST["prog_article"];
	$prog_comment = $_POST["prog_comment"];
	$prog_member	= $_POST["prog_member"];
	$subject_s		= $_POST["subject_s"];


	//=======================================================
	// 형변환
	$prog_article = (int)$prog_article;
	$prog_comment = (int)$prog_comment;
	$prog_member	= (int)$prog_member;

	#########################################################
	# 끝 => QUERY_STRING__형변환
	#########################################################



	#########################################################
	# 시작 => 유효검사
	#########################################################

	//=======================================================
	// 시작 => 항목__선택하지_않았으면
	IF ($prog_article != 1 && $prog_comment != 1 && $prog_member != 1)
	{
		// 에러
		alert ("[ 신고사유 ] 를 적용할 항목을 (게시글, 댓글, 회원) 중 1개이상 선택해 주세요.", "./pi__reason.list.php");
		EXIT;
	}
	// 끝 => 항목__선택하지_않았으면
	//=======================================================


	//=======================================================
	// 시작 => 신고사유_제목__입력하지_않았으면
	IF (!$subject_s || $subject_s == "")
	{
		// 에러
		alert ("[ 신고사유 제목 ] 은 필수입력사항입니다. 입력해 주세요.", "./pi__reason.list.php");
		EXIT;
	}
	// 끝 => 신고사유_제목__입력하지_않았으면
	//=======================================================

	#########################################################
	# 끝 => 유효검사
	#########################################################



	#########################################################
	# 시작 => 신고하기__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 신고하기__설정_정보__가져오기
	$is_get__report = 1;


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	include_once($piree_dir_path);

	#########################################################
	# 끝 => 신고하기__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 신고제목__중복검사
	#########################################################

	//=======================================================
	// 중복_확인__쿼리문
	$sql	 = "SELECT COUNT(*) FROM `".$piree_table['report_reason']."`";
	$sql	.= "WHERE (prog_article=1 OR prog_comment=1 OR	prog_member=1) AND subject_s='".$subject_s."'";
	$exist = sql_efv($sql);


	//=======================================================
	// 시작 => 중복이면
	IF ($exist > 0)
	{
		// 에러
		alert ("이미 입력된 [ 신고 항목 ]입니다..", "");
		EXIT;
	}
	// 끝 => 중복이면
	//=======================================================

	#########################################################
	# 끝 => 신고제목__중복검사
	#########################################################



	#########################################################
	# 시작 => 입력하기
	#########################################################

	//=======================================================
	// 입력_하는__쿼리문
	$sql	= "INSERT INTO `".$piree_table['report_reason']."` SET ";
	$sql .= "regi_mem_mn=".$member['mb_no'].", ";
	$sql .= "regi_mem_id='".$_SESSION['ss_mb_id']."', ";
	$sql .= "regi_mem_nick='".$member['mb_nick']."', ";
	$sql .= "prog_article=".$prog_article.", ";
	$sql .= "prog_comment=".$prog_comment.", ";
	$sql .= "prog_member=".$prog_member.", ";
	$sql .= "subject_s='".$subject_s."', ";
	$sql .= "ip_s='".$_SERVER['REMOTE_ADDR']."', ";
	$sql .= "regi_time_n=".G5_SERVER_TIME;


	//=======================================================
	// 시작 => 입력하기
	IF ( !sql_query ($sql) )
	{

		// 메세지
		$msg_in_s = "[ 신고사유 제목 ] 을 입력하지 못했습니다.";

		// 에러
		alert ($msg_in_s, "./pi__level.form.php");
		EXIT;

	}
	// 끝 => 입력하기
	//=======================================================

	#########################################################
	# 끝 => 입력하기
	#########################################################



	#########################################################
	# 시작 => 순서_번호__동기화
	#########################################################

	//=======================================================
	// 입력_하는__쿼리문
	$sql	= "UPDATE `".$piree_table['report_reason']."` SET ";
	$sql .= "order_n=num ";
	$sql .= "WHERE order_n=0 OR order_n=''";


	//=======================================================
	// 시작 => 입력하기
	IF ( !sql_query ($sql) )
	{

		// 메세지
		$msg_in_s = "[ 신고사유 제목 ] 을 입력하지 못했습니다..";

		// 에러
		alert ($msg_in_s, "./pi__level.form.php");
		EXIT;

	}
	// 끝 => 입력하기
	//=======================================================

	#########################################################
	# 끝 => 순서_번호__동기화
	#########################################################



	#########################################################
	# 시작 => 페이지__이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	$go_url_s = "./pi__reason.list.php";


	//=======================================================
	// 에러
	goto_url($go_url_s);
	EXIT;

	#########################################################
	# 끝 => 회원수__새로고침_하기
	#########################################################


?>