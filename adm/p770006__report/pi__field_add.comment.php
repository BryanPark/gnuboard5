<?php

/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 03월 09일 일요일 오후 17시 17분, 날씨 꽃샘추위다... 찬 거센 바람이 계속 분다.

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 관리자 > 피리 신고하기 PLUS G5 > 게시글 필드 추가하기
===========================================================


*/


	#########################################################
	# 시작 => 선_처리__메뉴_지정__관리자_확인
	#########################################################

	//=======================================================
	// 메뉴_번호__지정____신고하기
	$sub_menu = "770006";


	//=======================================================
	// 기본처리_파일__첨부
	include_once('./_common.php');


	//=======================================================
	// 관리자_확인
	auth_check($auth[$sub_menu], 'r');

	#########################################################
	# 끝 => 선_처리
	#########################################################



	#########################################################
	# 시작 => 신고하기__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 신고하기__설정_정보__가져오기
	$is_get__report = 1;


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	$piree_dir_path = PIREE_CONFIG_PATH ."/p__".$sub_menu."/pi__config.php";


	//=======================================================
	// 신고하기__설정_정보_파일__경로
	include_once($piree_dir_path);

	#########################################################
	# 끝 => 신고하기__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 상수__변수__배열
	#########################################################

	//=======================================================
	// 다음으로_넘어가기
	// 0 - 안가
	// 1이상 - 가자
	$is_go_next = 0;


	//=======================================================
	// 이동할__페이지
	$go_url_s = "./pi__field_add.comment.php";

	#########################################################
	# 끝 => 상수__변수__배열
	#########################################################



	#########################################################
	# 시작 => 작업_처리__변수
	#########################################################

	//=======================================================
	// 다음_테이블__확인
	$next_table = "";


	//=======================================================
	// 필드_추가__작업_여부
	// 0 - 안가
	// 1이상 - 가자
	$is_add__fd = 0;


	//=======================================================
	// 다음_테이블__확인
	$table_f_s = "/^".$g5['write_prefix']."/";

	#########################################################
	# 끝 => 작업_처리__변수
	#########################################################



	#########################################################
	# 시작 => 테이블_목록__불러오기
	#########################################################

	//=======================================================
	// 테이블_목록
	//$table_arr = mysql_list_tables(G5_MYSQL_DB);
	$table_arr = sql_query("SHOW TABLES");

	//=======================================================
	// 테이블_수__세기
	$table_t = sql_num_rows($table_arr);


	//=======================================================
	// 시작 => 테이블_있으면
	IF ($table_t > 0)
	{

		//=====================================================
		// 시작 => 반복문
		//FOR($i=0; $i<$table_t; $i++)
		while($table_s = sql_fetch_row($table_arr)[0])
		{

			//===================================================
			// 테이블_이름
			//$table_s = mysql_tablename($table_arr, $i);


			//===================================================
			// 시작 => 게시판_이름
			//IF (eregi($table_f_s, $table_s))
			if(preg_match($table_f_s,$table_s))
			{

				//=================================================
				// ROW_1개__가져오기
				$sql = "SELECT * FROM ".$table_s." LIMIT 1";
				$row = sql_fetch($sql);


				//=================================================
				// 시작 => 칼럼__없으면
				IF (!isset($row['wr_pi_report_t']))
				{

						//=============================================
						// 필드_추가__쿼리문
						$sql = "ALTER TABLE `".$table_s."` ADD `wr_pi_report_t` tinyint(4) UNSIGNED NOT NULL DEFAULT '0'";
						sql_query ($sql, false);

				}
				// 끝 => 칼럼__없으면
				//=================================================
				
				//===========================================
				// 시작 => 칼럼__없으면 2016-07-07 by Bryan Park [블라인드 여부 칼럼 추가 ]
				IF (!isset($row['wr_blind']))
				{

						//=======================================
						// 필드_추가__쿼리문 2016-07-07 by Bryan Park [Y 또는 N을 가지는 wr_blind column 추가]
						$sql = "ALTER TABLE `".$table_s."` ADD `wr_blind` set('Y','N') NOT NULL DEFAULT 'N'";
						sql_query ($sql, false);

				}
				// 끝 => 칼럼__없으면
				//===========================================

			}
			// 끝 => 게시판_이름
			//===================================================

		}
		// 끝 => 반복문
		//=====================================================

	}
	// 끝 => 테이블_있으면
	//=======================================================

	#########################################################
	# 끝 => 테이블_목록__불러오기
	#########################################################



	#########################################################
	# 시작 => 마무리__페이지_이동
	#########################################################

	//=======================================================
	// 이동할__페이지
	$go_url_s = "./pi__field_add.member.php";


	//=======================================================
	// 페이지_이동
	goto_url($go_url_s);
	EXIT;

	#########################################################
	# 끝 => 마무리__페이지_이동
	#########################################################


?>