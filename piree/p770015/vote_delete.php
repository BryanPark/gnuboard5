<?php

/*
===========================================================

	프로젝트 이름 : 피리 웹프로그램

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2016년 01월 02일 토요일 오전 02시 02분 - 날씨 덜추워~ 오늘 공기질 안좋아진다는데 망할 뒹국...

	저 작 권 : Copyright ⓒ 2014-2015 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 피리 게시글에 투표 > 투표 개별 삭제하기
===========================================================


*/


	#########################################################
	# 시작 => 선처리
	#########################################################

	//=======================================================
	// 개별_페이지__접근_불가
	IF ( !defined('_GNUBOARD_') )										EXIT;

	#########################################################
	# 끝 => 선처리
	#########################################################



	#########################################################
	# 시작 => 피리_게시글에_투표__설정_정보_파일__첨부
	#########################################################

	//=======================================================
	// 피리_메뉴__번호
	$piree_menu_n = 770015;


	//=======================================================
	// 기본_설정_첨부__여부
	// 0 - 안해
	$is_get__piree_config = 0;


	//=======================================================
	// 피리_게시글에_투표__설정_정보__가져오기
	$is_get__article_vote = 1;


	//=======================================================
	// 피리_게시글에_투표__설정_정보_파일__경로
	include_once( get__sam_file($piree_menu_n, '') );

	#########################################################
	# 끝 => 피리_게시글에_투표__설정_정보_파일__첨부
	#########################################################



	#########################################################
	# 시작 => 투표_주제_ROW__삭제하기
	#########################################################

	//=======================================================
	// 투표_주제_ROW__유무__알아내기
	$sql = "SELECT COUNT(*) FROM `".$piree_table['vote_list']."` WHERE `avl_bo_table` = '". $bo_table ."' AND `avl_wr_id` = '". $wr_id ."'";
	$exist_t = sql_fetch($sql);


	//=======================================================
	// 시작 => 투표_주제_ROW__있으면
	IF ( $exist_t > 0 )
	{

			//===================================================
			// 투표_주제_ROW__가져오기
			$sql = "SELECT * FROM `".$piree_table['vote_list']."` WHERE `avl_bo_table` = '". $bo_table ."' AND `avl_wr_id` = '". $wr_id ."'";
			$vote_row = sql_fetch($sql);


			//===================================================
			// 시작 => 투표_주제_ROW__있으면
			IF ( $vote_row['avl_bo_table'] == $bo_table && $vote_row['avl_wr_id'] == $wr_id )
			{

					//===============================================
					// 이미지__폴더_이름_정보__가져오기
					$image_in_a = get_vote_image_info($bo_table, $wr_id);


					//===============================================
					// 이미지__폴더__삭제하기
					delete__dir_file($image_in_a['path']);


					//===============================================
					// 투표_주제_ROW__삭제하기
					$sql = "DELETE FROM `".$piree_table['vote_list']."` WHERE `avl_bo_table` = '". $bo_table ."' AND `avl_wr_id` = '". $wr_id ."'";


					//===============================================
					// 시작 => 쿼리_실행
					IF ( !sql_query ($sql) )
					{
							alert("투표 주제를 삭제하지 못했습니다.");
					}
					// 끝 => 쿼리_실행
					//===============================================

			}
			// 끝 => 투표_주제_ROW__있으면
			//===================================================

	}
	// 끝 => 투표_주제_ROW__있으면
	//=======================================================

	#########################################################
	# 끝 => 투표_주제_ROW__삭제하기
	#########################################################



	#########################################################
	# 시작 => 투표_참여_ROW__삭제하기
	#########################################################

	//=======================================================
	// 투표_참여_ROW__유무__알아내기
	$sql = "SELECT COUNT(*) FROM `".$piree_table['vote_result']."` WHERE `avr_bo_table` = '". $bo_table ."' AND `avr_wr_id` = '". $wr_id ."'";
	$exist_t = sql_fetch($sql);


	//=======================================================
	// 시작 => 투표_참여_ROW__있으면
	IF ( $exist_t > 0 )
	{

			//===================================================
			// 투표_참여_ROW__삭제하기
			$sql = "DELETE FROM `".$piree_table['vote_result']."` WHERE `avr_bo_table` = '". $bo_table ."' AND `avr_wr_id` = '". $wr_id ."'";


			//===================================================
			// 시작 => 쿼리_실행
			IF ( !sql_query ($sql) )
			{
					alert("투표 참여 정보를 삭제하지 못했습니다.");
			}
			// 끝 => 쿼리_실행
			//===================================================

	}
	// 끝 => 투표_참여_ROW_번호__있으면
	//=======================================================

	#########################################################
	# 끝 => 투표_참여_ROW__삭제하기
	#########################################################


?>