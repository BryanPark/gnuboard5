
/*
===========================================================

	프로젝트 이름 : Piree Web Program

	만든사람 : 피리 PIREE

	홈페이지 : http://www.piree.co.kr

	작성날짜 : 2014년 12월 30일 화요일 오후 23시 33분 - 날씨 추워 추워

	저 작 권 : Copyright ⓒ 2014 투스포츠 (원병철) All right reserved
							그누보드 외에 추가된 소스는~
							만든사람의 허락없이 무단으로 사용할수 없습니다.
							사용하고자 할 경우 만든사람의 허락을 받아야 합니다.
							http://www.piree.co.kr 에 문의해 주세요.

===========================================================
 피리 > 피리 게시글에 투표 PLUS G5 > 자바스크립트 > 투표하기
===========================================================


*/


  //#######################################################
  // 시작 => 상수__변수
  //#######################################################

  		//===================================================
  		// 

  //#######################################################
  // 끝 => 상수__변수
  //#######################################################




  //#######################################################
  // 시작 => JQ
  //#######################################################
  $(function(){


  		//###################################################
  		// 시작 => 
  		// 끝 => 
  		//###################################################


  });
  function is_error_ajax(msg_s)
      {

          //===============================================
          // 시작 => 에러__여부
          if (msg_s.substring(0, 7) == "#ERROR:")
          {

              //###########################################
              // 시작 => 에러

              //===========================================
              // 시작 => 에러
              alert (msg_s.substring(7, msg_s.length));
              return false;

          }
          else
          {

              //###########################################
              // 시작 => 에러_아니니__통과

              return true;

          }
          // 끝 => 에러__여부
          //===============================================

      }
  //#######################################################
  // 끝 => JQ
  //#######################################################




  //#######################################################
  // 시작 => 함수
  //#######################################################

	//*******************************************************
	//** PWP__760015__ARTICLE_VOTE
	//*******************************************************

  		//###################################################
  		// 시작 => 투표_항목__체크하기
  		//###################################################
  		function check_vote_multi(gform, obj)
  		{

  		    //===============================================
  				// 투표_체크_수
  				var vote_checked_t = 0;


  		    //===============================================
  				// 비활성화_수
  				var disabled_t = 0;


  		    //===============================================
  				// 선택된_ELEMENT_번호
  				var choice_n = 0;


  		    //===============================================
  				// 시작 => FORM__있으면
  				if (gform)
  				{

  		    		//===========================================
  						// 시작 => 반복문
  						for (var i=0; i<gform.elements.length; i++)
  						{

		  		    		//=======================================
  								// 시작 => 투표_항목__이면
									if (gform.elements[i].name.substring(0, 10) == "atvt_vote[")
									{

		  		    				//===================================
											// 시작 => 체크__되었으면
											if (gform.elements[i].checked == true)
											{

		  		    						//===============================
		  		    						// 투표_체크_수__증가
		  		    						vote_checked_t++;

											}
											// 끝 => 체크__되었으면
		  		    				//===================================


		  		    				//===================================
											// 시작 => 체크__되었으면
											if (gform.elements[i].value == obj.value)
											{

		  		    						//===============================
		  		    						// 선택된_ELEMENT_번호__지정
		  		    						choice_n = i;

											}
											// 끝 => 체크__되었으면
		  		    				//===================================

									}
  								// 끝 => 투표_항목__이면
		  		    		//=======================================

  						}
  						// 끝 => 반복문
  		    		//===========================================


  		    		//===========================================
  						// 시작 => 다중투표__투표_체크_수__비교
  						if (vote_do_t > vote_checked_t)
  						{

		  		    		//#######################################
		  		    		//## 시작 => 다중투표__더_투표_가능함

		  		    		//=======================================
		  		    		// 시작 => 반복문
		  		    		for (var i=0; i<gform.elements.length; i++)
		  		    		{

											//===================================
		  		    				// 시작 => 투표_항목__이면
		  		    				if (gform.elements[i].name.substring(0, 10) == "atvt_vote[")
		  		    				{

		  		    						//===============================
													// 시작 => 비활성화__되었으면
													if (gform.elements[i].disabled == true)
													{

		  		    								//===========================
		  		    								// 활성화__시킴
		  		    								gform.elements[i].disabled = false;
		  		    								gform.elements[i].style.backgroundcolor = '#f0f0f0';


		  		    								//===========================
		  		    								// 비활성화_수__감소
		  		    								disabled_t--;

													}
													// 끝 => 체크__되었으면
		  		    						//===============================

		  		    				}
		  		    				// 끝 => 투표_항목__이면
											//===================================

		  		    		}
		  		    		// 끝 => 반복문
		  		    		//=======================================

  						}
  						else
  						{

		  		    		//#######################################
		  		    		//## 시작 => 다중투표__더_투표_불가

		  		    		//=======================================
		  		    		// 시작 => 투표_체크_수_가__다중투표__초과_했으면
  								if (vote_checked_t > vote_do_t)
		  		    		{
											alert ("이 투표는 [ "+vote_do_t+" ]표 까지만 할수 있습니다.");
											gform.elements[choice_n].checked = false;
											vote_checked_t--;
		  		    		}
		  		    		// 끝 => 투표_체크_수_가__다중투표__초과_했으면
		  		    		//=======================================


		  		    		//=======================================
		  		    		// 시작 => 반복문
		  		    		for (var i=0; i<gform.elements.length; i++)
		  		    		{

											//===================================
		  		    				// 시작 => 투표_항목__이면
		  		    				if (gform.elements[i].name.substring(0, 10) == "atvt_vote[")
		  		    				{

		  		    						//===============================
													// 시작 => 체크_되지__않았으면
													if (gform.elements[i].checked == false)
													{

		  		    								//===========================
		  		    								// 비활성화__시킴
		  		    								gform.elements[i].disabled = true;
		  		    								gform.elements[i].style.backgroundcolor = '#fff';


		  		    								//===========================
		  		    								// 비활성화_수__증가
		  		    								disabled_t++;

													}
													// 끝 => 체크_되지__않았으면
		  		    						//===============================

		  		    				}
		  		    				// 끝 => 투표_항목__이면
											//===================================

		  		    		}
		  		    		// 끝 => 반복문
		  		    		//=======================================

  						}
  						// 끝 => 다중투표__체크_수__비교
  		    		//===========================================

  				}
  				// 끝 => FORM__있으면
  		    //===============================================

  		}
  		//###################################################
  		// 끝 => 투표_항목__체크하기
  		//###################################################



  		//###################################################
  		// 시작 => 투표_결과_보기__이동
  		//###################################################
  		function go__vote_view_page(bo_table, wr_id, v_page)
  		{

  		    //===============================================
  				// 시작 => 게시판_테이블__게시글_번호__있으면
  				if (bo_table && wr_id> 0)
  				{

							//===========================================
  						// 결과_보기_페이지__URL
  						var result_url = Piree_Article_Vote_Url+"/vote_view.php?bo_table="+bo_table+"&wr_id="+wr_id+"&v_page="+v_page;


							//===========================================
							// 시작 => AJAX
							$.ajax({
									cache:false,
									type: "GET",
									dataType: "text",
									url: result_url,
									success:function(result)
									{
											if (is_error_ajax(result))
											{
													$("#article_vote_view").html(result);
											}
									}
							});
  						// 끝 => AJAX
							//===========================================

  				}
  				// 끝 => 게시판_테이블__게시글_번호__있으면
  		    //===============================================

  		}
  		//###################################################
  		// 끝 => 투표_결과_보기__이동
  		//###################################################



  		//###################################################
  		// 시작 => 투표하기__실행
  		//###################################################
  		function submit__article_vote_do(gform)
  		{

  				//###############################################
  				//# 시작 => 다중투표__단일투표__구분
  				//###############################################

  		    //===============================================
  				// 시작 => 다중투표__단일투표__구분
  				if (vote_do_t > 1)
  				{

  						//###########################################
  						//# 시작 => 다중투표__이면
  						//###########################################

  		    		//===========================================
  						// 투표_체크_수
  						var vote_checked_t = 0;


  		    		//===========================================
  						// 첫번째_투표항목
  						var first_poll_obj = "";


  		    		//===========================================
  						// 시작 => 반복문
  						for (var i=0; i<gform.elements.length; i++)
  						{

		  		    		//=======================================
  								// 시작 => 투표_항목__이면
									if (gform.elements[i].name.substring(0, 10) == "atvt_vote[")
									{

		  		    				//===================================
											// 시작 => 첫번째_투표항목__없으면
											if (first_poll_obj == "")
											{

		  		    						//===============================
		  		    						// 첫번째_투표항목
		  		    						first_poll_obj = gform.elements[i];

											}
											// 끝 => 첫번째_투표항목__없으면
		  		    				//===================================


		  		    				//===================================
											// 시작 => 체크__되었으면
											if (gform.elements[i].checked == true)
											{

		  		    						//===============================
		  		    						// 투표_체크_수__증가
		  		    						vote_checked_t++;

											}
											// 끝 => 체크__되었으면
		  		    				//===================================

									}
  								// 끝 => 투표_항목__이면
		  		    		//=======================================

  						}
  						// 끝 => 반복문
  		    		//===========================================


							//===========================================
  						// 시작 => 다중투표__투표_체크_수__비교
  						if (vote_checked_t == 0)
  						{
									alert ("투표항목을 1개 이상 선택해 주세요.");
									first_poll_obj.focus();
									return false;
  						}
  						// 끝 => 다중투표__투표_체크_수__비교
  		    		//===========================================

  				}
  				else
  				{

  						//###########################################
  						//# 시작 => 단일투표__이면
  						//###########################################

  		    		//===========================================
  						// 투표_체크_수
  						var vote_checked_t = 0;


  		    		//===========================================
  						// 시작 => 반복문
  						for (var i=0; i<gform.elements.length; i++)
  						{

		  		    		//=======================================
  								// 시작 => 투표_항목__이면
									if (gform.elements[i].name == "atvt_vote_n")
									{

		  		    				//===================================
											// 시작 => 체크__되었으면
											if (gform.elements[i].checked == true)
											{

		  		    						//===============================
		  		    						// 투표_체크_수__증가
		  		    						vote_checked_t++;

											}
											// 끝 => 체크__되었으면
		  		    				//===================================

									}
  								// 끝 => 투표_항목__이면
		  		    		//=======================================

  						}
  						// 끝 => 반복문
  		    		//===========================================


							//===========================================
  						// 시작 => 다중투표__투표_체크_수__비교
  						if (vote_checked_t == 0)
  						{
									alert ("투표항목을 1개 이상 선택해 주세요.");
									gform.atvt_vote_n[0].focus();
									return false;
  						}
  						// 끝 => 다중투표__투표_체크_수__비교
  		    		//===========================================

  				}
  				// 끝 => 다중투표__단일투표__구분
  		    //===============================================

  				//###############################################
  				//# 끝 => 다중투표__단일투표__구분
  				//###############################################



  				//###############################################
  				//# 시작 => AJAX
  				//###############################################

  				//===============================================
  				// POST_PARAMETERS
  				param_s = $("input").serialize();


  				//===============================================
  				// 시작 => AJAX
  				$.ajax({
  						cache:false,
  						type: "POST",
  						data: param_s, 
  						dataType: "text",
  						url: Piree_Article_Vote_Url+"/vote_view.php",
  						success:function(result)
  						{
  								if (is_error_ajax(result))
  								{
											$("#article_vote_view").html(result);
  								}
  						}
  				});
  						// 끝 => AJAX
  				//===============================================


  				//===============================================
  				// 끝
  				return false;

  				//###############################################
  				//# 끝 => AJAX
  				//###############################################

  		}
  		//###################################################
  		// 끝 => 투표하기__실행
  		//###################################################

  //#######################################################
  // 끝 => 함수
  //#######################################################

